# OpenTelemetry Integration with Traefik 3.0 ðŸ“Š

In this step, we'll configure Traefik 3.0 to use OpenTelemetry for observability, set up a sample backend service, and demonstrate tracing and metrics integration.

## Setting up the environment

First, let's install arkade, which we'll use to deploy Prometheus:

```bash
curl -sLS https://get.arkade.dev | sudo sh
```{{exec}}

Now, let's use arkade to install Prometheus:

```bash
arkade install prometheus
```{{exec}}

## Configuring Traefik for OpenTelemetry

Let's update our Traefik configuration to enable OpenTelemetry:

```bash
cat << EOF > traefik.yml
entryPoints:
  web:
    address: ":80"

providers:
  file:
    directory: /etc/traefik/dynamic
    watch: true

api:
  insecure: true
  dashboard: true

metrics:
  prometheus: {}

tracing:
  otlp:
    http:
      endpoint: "http://localhost:4318"
EOF
```{{exec}}

## Setting up a sample backend service

Let's deploy a simple web service using Docker:

```bash
docker run -d --name whoami -p 80:80 traefik/whoami
```{{exec}}

Now, create a dynamic configuration for this service:

```bash
mkdir -p /etc/traefik/dynamic
```{{exec}}

```bash
cat << EOF > /etc/traefik/dynamic/whoami.yml
http:
  routers:
    whoami:
      rule: "PathPrefix(\`/whoami\`)"
      service: whoami
  services:
    whoami:
      loadBalancer:
        servers:
          - url: "http://whoami"
EOF
```{{exec}}

## Starting Traefik with OpenTelemetry

Start Traefik with our new configuration:

```bash
traefik --configfile=traefik.yml
```{{exec}}

## Generating traffic and observing metrics

In a new terminal, generate some traffic:

```bash
for i in {1..10}; do curl -s http://localhost/whoami > /dev/null; done
```{{exec}}

Now, you can access the Prometheus UI to see the metrics generated by Traefik. You can access it by clicking here: {{TRAFFIC_HOST1_9090}}

In the Prometheus UI, you can query for Traefik metrics like `traefik_config_reloads_total` or `traefik_entrypoint_requests_total`.

## Next Steps

In the next step, we'll explore Traefik's new support for the Gateway API!
