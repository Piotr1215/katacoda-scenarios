apiVersion: apps/v1
kind: Deployment
metadata:
  name: web-app
  labels:
    app: web-app
    team: demo
spec:
  replicas: 2
  selector:
    matchLabels:
      app: web-app
  template:
    metadata:
      labels:
        app: web-app
        version: v1
    spec:
      containers:
      - name: web
        image: nginx:alpine
        ports:
        - containerPort: 80
          name: http
        resources:
          requests:
            memory: "64Mi"
            cpu: "50m"
          limits:
            memory: "128Mi"
            cpu: "100m"
        volumeMounts:
        - name: html
          mountPath: /usr/share/nginx/html
      initContainers:
      - name: content-generator
        image: busybox:1.35
        command: ['sh', '-c']
        args:
          - |
            cat > /html/index.html <<EOF
            <!DOCTYPE html>
            <html>
            <head>
                <title>vCluster Demo App</title>
                <style>
                    body {
                        font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
                        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
                        color: white;
                        display: flex;
                        justify-content: center;
                        align-items: center;
                        height: 100vh;
                        margin: 0;
                    }
                    .container {
                        text-align: center;
                        padding: 2rem;
                        background: rgba(255, 255, 255, 0.1);
                        border-radius: 20px;
                        backdrop-filter: blur(10px);
                        box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
                    }
                    h1 { font-size: 2.5rem; margin-bottom: 1rem; }
                    .info {
                        background: rgba(255, 255, 255, 0.2);
                        padding: 1rem;
                        border-radius: 10px;
                        margin: 1rem 0;
                    }
                    .cluster-info {
                        font-family: monospace;
                        background: rgba(0, 0, 0, 0.3);
                        padding: 0.5rem;
                        border-radius: 5px;
                        margin: 0.5rem 0;
                    }
                </style>
            </head>
            <body>
                <div class="container">
                    <h1>ðŸš€ vCluster Demo Application</h1>
                    <div class="info">
                        <h2>Welcome to Virtual Kubernetes!</h2>
                        <p>This application is running inside a vCluster</p>
                        <div class="cluster-info">
                            Hostname: \$(hostname)<br>
                            Cluster: \${CLUSTER_NAME:-unknown}<br>
                            Team: \${TEAM_NAME:-demo}<br>
                            Version: v1.0.0
                        </div>
                    </div>
                    <div class="info">
                        <h3>vCluster Features:</h3>
                        <ul style="list-style: none; padding: 0;">
                            <li>âœ… Full Kubernetes API compatibility</li>
                            <li>âœ… Complete isolation from host cluster</li>
                            <li>âœ… Resource efficiency</li>
                            <li>âœ… Sub-minute provisioning</li>
                        </ul>
                    </div>
                </div>
            </body>
            </html>
            EOF
            echo "Content generated at: \$(date)" > /html/info.txt
        volumeMounts:
        - name: html
          mountPath: /html
      volumes:
      - name: html
        emptyDir: {}
---
apiVersion: v1
kind: Service
metadata:
  name: web-app
  labels:
    app: web-app
spec:
  type: ClusterIP
  ports:
  - port: 80
    targetPort: 80
    protocol: TCP
    name: http
  selector:
    app: web-app
---
apiVersion: v1
kind: Service
metadata:
  name: web-app-nodeport
  labels:
    app: web-app
spec:
  type: NodePort
  ports:
  - port: 80
    targetPort: 80
    protocol: TCP
    name: http
    nodePort: 30080
  selector:
    app: web-app