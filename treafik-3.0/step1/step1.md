# OpenTelemetry Integration with Traefik 3.0 ðŸ“Š

In this step, we'll configure Traefik 3.0 to use OpenTelemetry for observability, set up a sample backend service, and demonstrate tracing and metrics integration.

## Configuring Traefik for OpenTelemetry

First, let's update our Traefik configuration to enable OpenTelemetry:

```bash
cat << EOF > traefik.yml
entryPoints:
  web:
    address: ":80"

providers:
  file:
    directory: /etc/traefik/dynamic
    watch: true

api:
  insecure: true
  dashboard: true

metrics:
  openTelemetry:
    address: "jaeger:4317"
    protocol: "grpc"

tracing:
  openTelemetry:
    address: "jaeger:4317"
    protocol: "grpc"
EOF
```{{exec}}

## Setting up a sample backend service

Let's deploy a simple web service:

```bash
docker run -d --name whoami -p 80:80 traefik/whoami
```{{exec}}

Now, create a dynamic configuration for this service:

```bash
mkdir -p /etc/traefik/dynamic
cat << EOF > /etc/traefik/dynamic/whoami.yml
http:
  routers:
    whoami:
      rule: "PathPrefix(`/whoami`)"
      service: whoami
  services:
    whoami:
      loadBalancer:
        servers:
          - url: "http://whoami"
EOF
```{{exec}}

## Starting Traefik with OpenTelemetry

Start Traefik with our new configuration:

```bash
traefik --configfile=traefik.yml
```{{exec}}

## Generating traffic and observing traces

In a new terminal, generate some traffic:

```bash
for i in {1..10}; do curl -s http://localhost/whoami > /dev/null; done
```{{exec}}

Now, open the Jaeger UI (assuming it's set up and accessible) to see the traces generated by Traefik. You should see spans for each request, including details about the routing process, middleware applied, and backend communication.

## Viewing metrics

Open the Prometheus UI (assuming it's set up and accessible) and query for Traefik metrics. You should see various metrics related to request counts, latencies, and more.

In the next step, we'll explore Traefik's new support for the Gateway API!
