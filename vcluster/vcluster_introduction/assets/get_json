#!/bin/bash

sqlite3 state.db "SELECT value FROM kine;" > output.txt

# Define input and output files
INPUT_FILE="./output.txt"
OUTPUT_FILE="./filtered_output.json"

# Initialize an empty file
>"$OUTPUT_FILE"

# Read through each line of the input file
while IFS= read -r line; do
	# Check if the line is a valid JSON object
	echo "$line" | jq . &>/dev/null
	if [ $? -eq 0 ]; then
		# Append valid JSON object to the output file
		echo "$line" >>"$OUTPUT_FILE"
	fi
done <"$INPUT_FILE"

# Output a message
echo "Filtered JSON data has been written to $OUTPUT_FILE"
